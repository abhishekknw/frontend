<link rel="stylesheet" href="modules/pages/login/login.tmpl.css" />
<link rel="stylesheet" href="modules/common/loadingicon/loading-spinner.tmpl.css" />

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<link href="css/smallscreen.css" rel="stylesheet" media="screen" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<div ng-init="getActiveUser()">
  
  <!-- navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
          aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand">
          <div class="logo-sec-mca">
            <img src="images/machadalo-logo.png" alt="" title="" />
          </div>
        </a>
      </div>

      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li class="fa fa-comments" id="active-nav" aria-hidden="true" style="font-size: large" ng-click="getActiveUser()">
            Live chat
          </li>

          <li class="fa fa-user-circle" aria-hidden="true" style="font-size: large" ng-click="contactDetail()">
            Contact
          </li>

          <li class="fa fa-history" aria-hidden="true" style="font-size: large" ng-click="historyDetail()">
            History
          </li>

          <a href="#">
            <li class="fa fa-file-text" aria-hidden="true" style="font-size: large">
              Templates
            </li>
          </a>
          <a href="#">
            <li class="fa fa-filter" aria-hidden="true" style="font-size: large">
              Filter
            </li>
          </a>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>
  <!-- /navbar -->

  <!--Active chat list+status+chat details-->
  <div>
    <div  ng-if="!showhistoryDetail && !showcontactDetail">
      <div class="container dropdown mca-page">
        <!--tabs-->
        <div class="top-select-option-aisensy">
          <div class="form-group">
            <div class="tab-aisensy">
              <input id="tab-1" type="radio" name="tab" checked />
              <label for="tab-1">Active</label>
              <input id="tab-2" type="radio" name="tab" />
              <label for="tab-2">Requested</label>
              <input id="tab-3" type="radio" name="tab" />
              <label for="tab-3">Intervened</label>

              <div class="content">
                <div id="content-1">
                  <div class="row-aisensy no-gutters">
                    <div class="col-md-12 col-xs-12 border-right">
                      <div class="search-box" ng-if="!showChatModule">
                        <div class="input-wrapper">
                          <i class="fa fa-search" aria-hidden="true"></i>
                          <input placeholder="Search here" ng-change="searchChat(search)" ng-model="search" id="search" name="search"type="text" />
                        </div>
                      </div>

                      <div class="fields-box">
                        <div ng-if="!showChatModule" ng-repeat="user in activeUserData track by $index">
                          <div class="friend-drawer friend-drawer--onhover" ng-click="userDetail(user.phone_number)">
                            <!-- <img
                          class="profile-image"
                          src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/robocop.jpg"
                          alt=""
                        /> -->
                            <div class="profile-image">
                              {{user.whatsapp_name |firstlater}}
                            </div>
                            <div class="text">
                              <h6>{{user.whatsapp_name}}</h6>
                              <p class="text-muted">
                                {{user.country_code}}{{user.phone_number}}
                              </p>
                            </div>
                            <span class="time text-muted small">{{user.last_message_timestamp | date :
                              'medium'}}</span>
                          </div>

                          <hr />
                        </div>

                        <!-- Start Phone Chat-->
                        <div class="phone-chat" ng-if="showChatModule">
                          <div class="screen-phone">
                            <div class="nav-phone">

                              <div class="icon-back">
                                <svg viewBox="0 0 57.653 64.11" width="25" height="25"
                                  xmlns="http://www.w3.org/2000/svg" ng-click="hideChatModule()">

                                  <path fill="#fff"
                                    d="M 31.75 0 L 0 31.956 L 30.961 63.124 L 36.412 57.26 L 15.768 36.41 L 56.313 35.997 L 56.107 28.366 L 15.484 28.572 L 37.35 6.086 L 31.75 0 Z" />
                                </svg>


                              </div>
                              <div>
                                <!-- <span class="profile-image-chat" style="text-align: center;font-size: large;background-color: aliceblue;">
                                {{userChatData.whatsapp_name |firstlater}}
                               </span>&nbsp;&nbsp; -->
                                <span class="username">{{userChatData.whatsapp_name}}</span><br />
                                <span
                                  class="tel-number">({{userChatData.country_code}}{{userChatData.phone_number}})</span>

                              </div>

                            </div>

                            <div class="chat">
                              <div ng-repeat="chat in userChatData.payload track by $index">
                                <div class="message-1" ng-if="chat.sender=='user'">
                                  {{chat.content.text}}
                                  <span>{{chat.timestamp | date : format :
                                    timezone}}</span>
                                </div>

                                <div class="message-2" ng-if="chat.sender=='bot'">
                                  {{chat.content.text}}
                                  <span>{{chat.timestamp | date : format :
                                    timezone}}</span>
                                </div>
                              </div>
                              <div class="input">
                                <input type="text" placeholder="Write message" />
                              </div>
                              <div class="btn-send">
                                <svg viewBox="0 0 74.433 60.908" width="25" height="25"
                                  xmlns="http://www.w3.org/2000/svg">
                                  <path fill="#fff"
                                    d="M 0 0 L 74.22 26.562 L 0.246 60.712 L 7.608 34.535 L 27.831 28.259 L 6.91 25.469 L 0 0 Z" />
                                </svg>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!--
                  <div class="friend-drawer friend-drawer--onhover">
                    <img class="profile-image"
                      src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/optimus-prime.jpeg" alt="">
                    <div class="text">
                      <h6>Divyaaa</h6>
                      <p class="text-muted">HI! What's Up?</p>
                    </div>
                    <span class="time text-muted small">00:32</span>

                  </div>
                  <hr>
                  <div class="friend-drawer friend-drawer--onhover ">
                    <img class="profile-image"
                      src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png" alt="">
                    <div class="text">
                      <h6>Priyank</h6>
                      <p class="text-muted">HI! What's Up?</p>
                    </div>
                    <span class="time text-muted small">13:21</span>
                  </div>
                  <hr>
                  <div class="friend-drawer friend-drawer--onhover ">
                    <img class="profile-image"
                      src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png" alt="">
                    <div class="text">
                      <h6>Samyaak</h6>
                      <p class="text-muted">HI! What's Up?</p>
                    </div>
                    <span class="time text-muted small">13:21</span>
                  </div>-->
                      </div>
                    </div>
                  </div>
                </div>
                <!--end of first tab content-->

                <div id="content-2">
                  <div class="row-aisensy no-gutters">
                    <div class="col-md-12 col-xs-12 border-right">
                      <div class="search-box">
                        <div class="input-wrapper">
                          <i class="fa fa-search" aria-hidden="true"></i>
                          <input placeholder="Search here" type="text" />
                        </div>
                      </div>
                      <div class="fields-box">
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/robocop.jpg" alt="" />
                          <div class="text">
                            <h6>Aathira</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/optimus-prime.jpeg"
                            alt="" />
                          <div class="text">
                            <h6>Divyaaa</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">00:32</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png"
                            alt="" />
                          <div class="text">
                            <h6>Priyank</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png"
                            alt="" />
                          <div class="text">
                            <h6>Samyaak</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--end of second tab content-->
                <div id="content-3">
                  <div class="row-aisensy no-gutters">
                    <div class="col-md-12 col-xs-12 border-right">
                      <div class="search-box">
                        <div class="input-wrapper">
                          <i class="fa fa-search" aria-hidden="true"></i>
                          <input placeholder="Search here" type="text" />
                        </div>
                      </div>
                      <div class="fields-box">
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/robocop.jpg" alt="" />
                          <div class="text">
                            <h6>Aathira</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/optimus-prime.jpeg"
                            alt="" />
                          <div class="text">
                            <h6>Divyaaa</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">00:32</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png"
                            alt="" />
                          <div class="text">
                            <h6>Priyank</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                        <hr />
                        <div class="friend-drawer friend-drawer--onhover">
                          <img class="profile-image"
                            src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/real-terminator.png"
                            alt="" />
                          <div class="text">
                            <h6>Samyaak</h6>
                            <p class="text-muted">HI! What's Up?</p>
                          </div>
                          <span class="time text-muted small">13:21</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--/tabs-->
      </div>

      <!-- Status -->

      <div class="container dropdown aisensy-page">
        <div ng-if="userDetailData">
          <div class="top-select-option-mca">
            <div class="form-group">
              <div class="profile">
                <div class="friend-drawer-status friend-drawer--onhover">
                  <!-- <img
                class="status-image center"
                src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/robocop.jpg"
                alt=""
              /><br /> -->
                  <div class="status-image">
                    {{userDetailData.whatsapp_name |firstlater}}
                  </div>
                  <div class="text">
                    <h6>{{userDetailData.whatsapp_name}}</h6>
                    <p class="text-muted">
                      {{userDetailData.country_code}}{{userDetailData.phone_number}}
                    </p>
                  </div>
                  <hr />

                  <div class="filter-card">
                    <div class="row">
                      <div class="col-sm-12">
                        <div class="info-table-wrap-mca">
                          <div class="info-table-covidhelp">
                            <div class="info-row-mca">
                              <label class="infolable-mca"> Session ID:</label>
                              <span> {{userDetailData.session_id}}</span>
                            </div>

                            <div class="info-row-mca">
                              <label class="infolable-mca">User Type:</label>
                              <span> {{userDetailData.user_type}}</span>
                            </div>

                            <div class="info-row-mca">
                              <label class="infolable-mca">Created At:</label>
                              <span>
                                {{userDetailData.created_at | date :
                                'medium'}}</span>
                            </div>

                            <div class="info-row-mca">
                              <label class="infolable-mca">Last Active:</label>
                              <span>
                                {{userDetailData.updated_at | date :
                                'medium'}}</span>
                            </div>

                            <!-- 
                    <div class="info-row-mca">
                      <label class="infolable-mca">Template Messages:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div> -->

                            <!-- <div class="info-row-mca">
                      <label class="infolable-mca">Session Messages:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div> -->

                            <!-- <div class="info-row-mca">
                      <label class="infolable-mca">Unsolved Queries:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div> -->

                            <!-- <div class="info-row-mca">
                      <label class="infolable-mca">Source:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div>

                    <div class="info-row-mca">
                      <label class="infolable-mca">Lead State:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div>

                    <div class="info-row-mca">
                      <label class="infolable-mca">First Message:</label>
                      <span> {{cases.yesterday_confirmed}}</span>
                    </div> -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Status End -->

                  <!-- <select class="form-control" name="sector" id="sector-aisensy" ng-change="changeWeb()" ng-model="selectedsector">
          <option value="" disabled>Template Messages</option>
          <option ng-repeat="sec in sectorArray track by $index" value="{{sec.name}}"
            style="text-transform: capitalize">
            {{cat.name}}
          </option>
        </select>
        <select class="form-control" name="sector" id="sector-aisensy" ng-change="changeWeb()" ng-model="selectedsector">
          <option value="" disabled>Customer Journey</option>
          <option ng-repeat="sec in sectorArray track by $index" value="{{sec.name}}"
            style="text-transform: capitalize">
            {{cat.name}}
          </option>
        </select>-->
                </div>
              </div>
            </div>
          </div>

          <!-- Start Template and Customer Journey-->
          <div class="bs-example col-md-12 col-xs-12">
            <label class="radio-inline">
              <input name="group1" value="1" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne"
                type="radio" />
              Template message
            </label>

            <div class="panel-group" id="accordion">
              <div class="panel panel-default">
                <div id="collapseOne" class="panel-collapse collapse in">
                  <div class="panel-body">
                    <h4>These are some Template message given to this user</h4>
                  </div>
                </div>
              </div>

              <label class="radio-inline">
                <input name="group1" value="2" data-toggle="collapse" data-parent="#accordion"
                  data-target="#collapseTwo" type="radio" />
                Customer Journey
              </label>

              <div class="panel panel-default">
                <div id="collapseTwo" class="panel-collapse collapse">
                  <div class="panel-body">
                    <div class="container mt-5 mb-5">
                      <div class="row">
                        <div class="col-md-6 offset-md-3">
                          <ul class="timeline">
                            <li>
                              <h5>User requested intervention</h5>
                              <h6>18:45, 19 Aug 2021</h6>
                            </li>
                            <li>
                              <h5>Chat closed by XYZ</h5>
                              <h6>15:15, 17 Aug 2021</h6>
                            </li>
                            <li>
                              <h5>Chat intervened by XYZ</h5>
                              <h6>14:43, 17 Aug 2021</h6>
                            </li>
                            <li>
                              <h5>User requested intervention</h5>
                              <h6>09:03, 15 Aug 2021</h6>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End Template and Customer Journey-->
        </div>

        <!-- Start Phone Chat-->
        <!-- <div class="phone-chat" ng-if="showChatModule">
      <div class="screen-phone">
        <div class="nav-phone">
          <div class="icon-back">
            <svg
              viewBox="0 0 57.653 64.11"
              width="25"
              height="25"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#fff"
                d="M 31.75 0 L 0 31.956 L 30.961 63.124 L 36.412 57.26 L 15.768 36.41 L 56.313 35.997 L 56.107 28.366 L 15.484 28.572 L 37.35 6.086 L 31.75 0 Z"
              />
            </svg>
          </div>
          <span class="username">{{userChatData.whatsapp_name}}</span><br />
          <span class="tel-number"
            >{{userChatData.country_code}}{{userChatData.phone_number}}</span
          >
        </div>
        <div class="chat">
          <div ng-repeat="chat in userChatData.payload track by $index">
            <div class="message-1" ng-if="chat.sender=='user'">
              {{chat.content.text}}
              <span>{{chat.timestamp | date : format : timezone}}</span>
            </div>

            <div class="message-2" ng-if="chat.sender=='bot'">
              {{chat.content.text}}
              <span>{{chat.timestamp | date : format : timezone}}</span>
            </div>
          </div>
          <div class="input">
            <input type="text" placeholder="Write message" />
          </div>
          <div class="btn-send">
            <svg
              viewBox="0 0 74.433 60.908"
              width="25"
              height="25"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill="#fff"
                d="M 0 0 L 74.22 26.562 L 0.246 60.712 L 7.608 34.535 L 27.831 28.259 L 6.91 25.469 L 0 0 Z"
              />
            </svg>
          </div>
        </div>
      </div>
    </div> -->
      </div>
      <!-- End Phone Chat-->
    </div>
  </div>
  <!--/Active chat list+status+chat details-->

  <!--History-->
  <div class="container dropdown mca-page"  ng-if="showhistoryDetail">
    <div class="top-select-option-aisensy">
      <div class="form-group">
          <div class="col-md-12 col-xs-12 border-right">
            <h3 style="
                font-family: Verdana, Geneva, Tahoma, sans-serif;
                top: 10px;
              ">
              <center>CHAT HISTORY</center>
            </h3>
            <div class="search-box">
              <div class="input-wrapper">
                <i class="fa fa-search" aria-hidden="true" style="margin-left: 10px"></i>
                <input placeholder="Search here" ng-change="searchChat()" ng-model="search" type="text" />
              </div>
            </div>

            <div class="fields-box" style="height: 400px">
              <div ng-repeat="details in historyDetailData track by $index">
                <div class="friend-drawer friend-drawer--onhover">
                  <!-- <img
                    class="profile-image"
                    src="https://www.clarity-enhanced.net/wp-content/uploads/2020/06/robocop.jpg"
                    alt=""
                  /> -->
                  <div class="profile-image">
                    {{details.whatsapp_name |firstlater}}
                  </div>
                  <div class="text">
                    <h6>{{details.whatsapp_name}}</h6>
                    <p class="text-muted">
                      {{details.country_code}}{{details.phone_number}}
                    </p>
                  </div>
                  <span class="time text-muted small">{{details.payload_timestamp}}</span>
                </div>

                <hr />
              </div>
            </div>
          </div>
        
      </div>
    </div>
  </div>
  <!--/History-->

  <!--Contact-->
  <div class="container dropdown mca-page" ng-if="showcontactDetail">
    <h3>Contact</h3>

    <div class="container table-responsive py-5">
      <table class="table table-bordered table-hover">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Sr. No.</th>
            <th scope="col">Name</th>
            <th scope="col">Mobile Number</th>
            <th scope="col">Status</th>
            <th scope="col">Last Active</th>
            <th scope="col">Created At</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="contact in contactDetailData track by $index">
            <th scope="row">1</th>
            <td>{{contact.whatsapp_name}}</td>
            <td>{{contact.country_code}}{{contact.phone_number}}</td>
            <td>{{contact.user_type}}</td>
            <td>{{contact.updated_at | date : 'medium'}}</td>
            <td>{{contact.created_at | date : 'medium'}}</td>
          </tr>
        </tbody>
      </table>

      <div data-pagination="" data-num-pages="numOfPages()" data-current-page="curPage" data-max-size="maxSize"
        data-boundary-links="true">
      </div>
    </div>
  </div>
  <!--/Contact-->
</div>